{% include base_path %}

{% if page.author_profile or layout.author_profile or page.sidebar or page.toc or page.filter %}
  <div class="sidebar sticky">
  {% if page.author_profile or layout.author_profile %}{% include author-profile.html %}{% endif %}
  {% if page.sidebar %}
    {% for s in page.sidebar %}
      {% if s.image %}
        <img src=
        {% if s.image contains "://" %}
          "{{ s.image }}"
        {% else %}
          "{{ s.image | prepend: "/images/" | prepend: base_path }}"
        {% endif %}
        alt="{% if s.image_alt %}{{ s.image_alt }}{% endif %}">
      {% endif %}
      {% if s.title %}<h3>{{ s.title }}</h3>{% endif %}
      {% if s.text %}{{ s.text | markdownify }}{% endif %}
    {% endfor %}
    {% if page.sidebar.nav %}
      {% include nav_list nav=page.sidebar.nav %}
    {% endif %}
  {% endif %}

  <!-- 标签筛选区域 - 仅在/news/页面显示 -->
  {% if page.url contains '/news/' %}
    <div class="filter-section" style="margin-top: 2rem; border-top: 1px solid #eee; padding-top: 1rem;">
      <h3 style="margin-bottom: 1rem;">Filter by Tags</h3>

      {% assign all_tags = "" | split: "," %}
      {% assign tag_groups = "" | split: "," %}

      {% for post in site.posts %}
        {% if post.tags %}
          {% for tag in post.tags %}
            {% assign clean_tag = tag | strip %}
            {% unless all_tags contains clean_tag %}
              {% assign all_tags = all_tags | push: clean_tag %}
            {% endunless %}

            {% assign tag_parts = clean_tag | split: ":" %}
            {% if tag_parts.size > 1 %}
              {% assign group_name = tag_parts[0] | strip %}
              {% unless tag_groups contains group_name %}
                {% assign tag_groups = tag_groups | push: group_name %}
              {% endunless %}
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endfor %}

      {% for group_name in tag_groups %}
        <div class="filter-group" style="margin-bottom: 1rem;">
          <h4 style="margin: 0.5rem 0; font-size: 0.9em; color: #555;">{{ group_name }}</h4>
          <div style="display: flex; flex-wrap: wrap; gap: 4px;">
            {% for tag in all_tags %}
              {% assign tag_parts = tag | split: ":" %}
              {% if tag_parts.size > 1 %}
                {% assign current_group = tag_parts[0] | strip %}
                {% if current_group == group_name %}
                  {% assign tag_display = tag_parts[1] | strip %}
                  <button class="filter-tag" data-tag="{{ tag | downcase }}"
 style="margin: 2px; padding: 4px 8px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; cursor: pointer; white-space: normal; word-wrap: break-word; max-width: 100%; font-size: 0.85em;">
                    {{ tag_display }}
                  </button>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      <div class="filter-group" style="margin-bottom: 1rem;">
        <h4 style="margin: 0.5rem 0; font-size: 0.9em; color: #555;">Other Tags</h4>
        <div style="display: flex; flex-wrap: wrap; gap: 4px;">
          {% for tag in all_tags %}
            {% unless tag contains ":" %}
              <button class="filter-tag" data-tag="{{ tag | downcase }}"
                      style="margin: 2px; padding: 4px 8px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; cursor: pointer; white-space: normal; word-wrap: break-word; max-width: 100%; font-size: 0.85em;">
                {{ tag }}
              </button>
            {% endunless %}
          {% endfor %}
        </div>
      </div>

      <button class="clear-filter" style="margin-top: 10px; padding: 6px 12px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer; width: 100%;">
        Clear All Filters
      </button>
    </div>
  {% endif %}


  {% if page.toc %}
    {% include toc content=content title="Contents" %}
  {% endif %}

  </div>
{% endif %}
