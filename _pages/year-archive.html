---
layout: archive
permalink: /news/
title: "News"
titleshow: false
author_profile: false
toc: false
filter: true
redirect_from:
  - /news/year/
---

{% include base_path %}

{% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse %}

<!-- 收集所有标签用于筛选 - 使用JSON格式确保正确解析 -->
<div id="posts-data" style="display: none;" data-posts='[
  {% for year_group in posts_by_year %}
    {% for post in year_group.items %}
      {
        "id": "{{ post.id | default: post.url | replace: '"', '\"' }}",
        "tags": {{ post.tags | jsonify }},
        "year": "{{ year_group.name }}"
      }{% unless forloop.last and forloop.parentloop.last %},{% endunless %}
    {% endfor %}
  {% endfor %}
]'></div>

{% for year_group in posts_by_year %}
  <section class="year-section" data-year="{{ year_group.name }}">
    <h1 id="{{ year_group.name | slugify }}" class="archive__subtitle">
      {{ year_group.name }} ({{ year_group.items.size }})
    </h1>

    <div class="grid__wrapper">
      {% for post in year_group.items %}
        <article class="archive__item"
                 itemscope itemtype="http://schema.org/CreativeWork"
                 data-post-id="{{ post.id | default: post.url | replace: '"', '\"' }}"
                 data-tags="{{ post.tags | join: ', ' | replace: '"', '\"' }}">

          {% if post.image_path %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">
                <img
                  style="height:210px;object-fit:cover;"
                  src=
                  {% if post.image_path contains "://" %}
                    "{{ post.image_path }}"
                  {% else %}
                    "{{ post.image_path | prepend: "/images/" | prepend: base_path }}"
                  {% endif %}
                alt="{% if post.alt %}{{ post.alt }}{% endif %}">
              </a>
            </div>
          {% else %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">
                <img
                  style="height:210px;object-fit:cover;"
                  src="{{ '/images/Loading.png' | prepend: base_path }}"
                  alt="Default image">
              </a>
            </div>
          {% endif %}

          {% if post.id %}
            {% assign title = post.covertitle | markdownify | remove: "<p>" | remove: "</p>" %}
          {% else %}
            {% assign title = post.covertitle %}
          {% endif %}

          <div class="archive__item-title">
            {% if post.link %}
              <a href="{{ post.link }}">{{ title }}</a> <a href="{{ base_path }}{{ post.url }}" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
            {% else %}
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
            {% endif %}
          </div>

          {% if post.collection == 'teaching' %}
            <div> {{ post.type }}, <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </div>
          {% elsif post.collection == 'publications' %}
            <div>Published in <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </div>
          {% elsif post.date %}
            <div class="page__meta"> <i class="fa fa-calendar" aria-hidden="true"></i> <time datetime="{{ post.date | default: "1900-01-01" | date_to_xmlschema }}">{{ post.date | default: "1900-01-01" | date: " %B %d, %Y" }}</time></div>
          {% endif %}

          {% if post.excerpt %}
            <small class="archive__item-excerpt" itemprop="description">{{ post.excerpt | markdownify }}</small>
          {% endif %}
        </article>

      {% endfor %}
    </div>
  </section>
{% endfor %}

<!-- 筛选逻辑JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('页面加载完成，开始初始化标签筛选器...');

  // 获取所有文章数据
  const postsDataElement = document.getElementById('posts-data');
  if (!postsDataElement) {
    console.error('未找到posts-data元素');
    return;
  }

  const postsData = postsDataElement.getAttribute('data-posts');
  console.log('原始数据:', postsData);

  let posts = [];
  try {
    posts = JSON.parse(postsData);
    console.log('解析后的文章数据:', posts);
  } catch (e) {
    console.error('JSON解析失败:', e);
    return;
  }

  // 提取并分组所有标签
  const tagGroups = {};

  posts.forEach(post => {
    if (post.tags && Array.isArray(post.tags)) {
      post.tags.forEach(tag => {
        const colonIndex = tag.indexOf(':');
        if (colonIndex > 0) {
          const group = tag.substring(0, colonIndex).trim();
          const value = tag.substring(colonIndex + 1).trim();

          if (!tagGroups[group]) {
            tagGroups[group] = new Set();
          }
          tagGroups[group].add(value);
        }
      });
    }
  });

  console.log('标签分组:', tagGroups);

  // 生成标签筛选器HTML
  const filterContainer = document.getElementById('tag-filter');
  if (!filterContainer) {
    console.error('未找到tag-filter容器');
    return;
  }

  if (Object.keys(tagGroups).length === 0) {
    filterContainer.innerHTML = '<div style="font-size: 0.9em; color: #666;">No tags found</div>';
    return;
  }

  let html = '<div class="tag-filter-container">';

  Object.keys(tagGroups).sort().forEach(group => {
    html += `<div class="tag-group">
 <h4>${group}:</h4>
              <div class="tag-values">`;

    Array.from(tagGroups[group]).sort().forEach(value => {
      const fullTag = `${group}: ${value}`;
      html += `<span class="tag-value" data-full-tag="${fullTag}">${value}</span>`;
    });

    html += '</div></div>';
  });

  html += '<button id="clear-filter" class="clear-filter-btn">Clear All Filters</button>';
  html += '</div>';

  filterContainer.innerHTML = html;
  console.log('标签筛选器HTML已生成');

  // 筛选功能
  const selectedTags = new Set();
  const allArticles = document.querySelectorAll('.archive__item');
  const allYearSections = document.querySelectorAll('.year-section');

  function applyFilter() {
    console.log('应用筛选，选中标签:', Array.from(selectedTags));

    if (selectedTags.size === 0) {
      // 显示所有文章
      allArticles.forEach(article => {
        article.style.display = 'block';
      });
      allYearSections.forEach(section => {
        section.style.display = 'block';
      });
      //重置计数
      allYearSections.forEach(section => {
        const year = section.getAttribute('data-year');
        const totalCount = section.querySelectorAll('.archive__item').length;
        const title = section.querySelector('.archive__subtitle');
        if (title) {
          title.textContent = `${year} (${totalCount})`;
        }
      });
      return;
    }

    // 隐藏所有文章和年份部分
    allArticles.forEach(article => {
      article.style.display = 'none';
    });
    allYearSections.forEach(section => {
      section.style.display = 'none';
    });

    // 显示匹配的文章和对应的年份部分
    allArticles.forEach(article => {
      const articleTags = article.getAttribute('data-tags').split(',').map(tag => tag.trim());

      // 检查文章是否包含所有选中的标签
      const hasAllTags = Array.from(selectedTags).every(selectedTag =>
        articleTags.includes(selectedTag)
      );

      if (hasAllTags) {
        article.style.display = 'block';
        // 显示该文章所属的年份部分
        const yearSection = article.closest('.year-section');
        if (yearSection) {
          yearSection.style.display = 'block';
        }
      }
    });

    // 更新年份计数
    updateYearCounts();
  }

  function updateYearCounts() {
    allYearSections.forEach(section => {
      if (section.style.display !== 'none') {
        const visibleArticles = section.querySelectorAll('.archive__item[style*="block"]');
        const count = visibleArticles.length;
        const title = section.querySelector('.archive__subtitle');
        if (title) {
          const year = section.getAttribute('data-year');
          title.textContent = `${year} (${count})`;
        }
      }
    });
  }

  // 为标签添加点击事件
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('tag-value')) {
      const fullTag = e.target.getAttribute('data-full-tag');

      if (selectedTags.has(fullTag)) {
        selectedTags.delete(fullTag);
        e.target.classList.remove('selected');
      } else {
        selectedTags.add(fullTag);
        e.target.classList.add('selected');
      }

      applyFilter();
    }

    // 清除筛选按钮
    if (e.target.id === 'clear-filter') {
      selectedTags.clear();
      document.querySelectorAll('.tag-value.selected').forEach(tag => {
        tag.classList.remove('selected');
      });
      applyFilter();
    }
  });
});
</script>




{% comment %}
<!-- 

{% include base_path %}

{% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse %}

{% for year_group in posts_by_year %}
  <section class="year-section">
    <h1 id="{{ year_group.name | slugify }}" class="archive__subtitle">
      {{ year_group.name }} ({{ year_group.items.size }})
    </h1>
    
    <div class="grid__wrapper">
      {% for post in year_group.items %}
        <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
          {% if post.image_path %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">
                <img 
                  style="height:210px;object-fit:cover;" 
                  src=
                  {% if post.image_path contains "://" %}
                    "{{ post.image_path }}"
                  {% else %}
                    "{{ post.image_path | prepend: "/images/" | prepend: base_path }}"
                  {% endif %}
                alt="{% if post.alt %}{{ post.alt }}{% endif %}">
              </a>
            </div>
          {% else %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">
                <img 
                  style="height:210px;object-fit:cover;" 
                  src="{{ '/images/Loading.png' | prepend: base_path }}" 
                  alt="Default image">
              </a>
            </div>
          {% endif %}

          {% if post.id %}
            {% assign title = post.covertitle | markdownify | remove: "<p>" | remove: "</p>" %}
          {% else %}
            {% assign title = post.covertitle %}
          {% endif %}

          <div class="archive__item-title">
            {% if post.link %}
              <a href="{{ post.link }}">{{ title }}</a> <a href="{{ base_path }}{{ post.url }}" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
            {% else %}
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
            {% endif %}
          </div>

          {% if post.collection == 'teaching' %}
            <div> {{ post.type }}, <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </div>
          {% elsif post.collection == 'publications' %}
            <div>Published in <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </div>
          {% elsif post.date %}
            <div class="page__meta"> <i class="fa fa-calendar" aria-hidden="true"></i> <time datetime="{{ post.date | default: "1900-01-01" | date_to_xmlschema }}">{{ post.date | default: "1900-01-01" | date: " %B %d, %Y" }}</time></div>
          {% endif %}

          {% if post.excerpt %}
            <small class="archive__item-excerpt" itemprop="description">{{ post.excerpt | markdownify }}</small>
          {% endif %}
        </article>

      {% endfor %}
    </div>
  </section>
{% endfor %}


{% capture written_year %}'None'{% endcapture %}
{% for post in site.posts %}
  {% capture year %}{{ post.date | date: '%Y' }}{% endcapture %}
  {% if year != written_year %}
    <h2 id="{{ year | slugify }}" class="archive__subtitle">{{ year }}</h2>
    {% capture written_year %}{{ year }}{% endcapture %}
  {% endif %}

  {% include archive-single.html type="grid" %}
{% endfor %} -->
{% endcomment %}
