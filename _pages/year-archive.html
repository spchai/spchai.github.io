---
layout: archive
permalink: /news/
title: "News"
titleshow: false
author_profile: false
toc: false
filter: true
redirect_from:
  - /news/year/
---


{% include base_path %}

{% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse %}

{% for year_group in posts_by_year %}
  <section class="year-section" data-year="{{ year_group.name }}">
    <h1 id="{{ year_group.name | slugify }}" class="archive__subtitle">
      {{ year_group.name }} ({{ year_group.items.size }})
    </h1>

    <div class="grid__wrapper">
      {% for post in year_group.items %}
        <article class="archive__item" data-tags="{{ post.tags | join: '|' }}">
          {% if post.image_path %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}">
                <img style="height:210px;width:100%;object-fit:cover;" 
                     src="{% if post.image_path contains '://' %}{{ post.image_path }}{% else %}{{ post.image_path | prepend: '/images/' | prepend: base_path }}{% endif %}" alt="">
              </a>
            </div>
          {% endif %}
          <div class="archive__item-title">
            <a href="{{ base_path }}{{ post.url }}">{{ post.covertitle | default: post.title }}</a>
          </div>
          <div class="page__meta"><i class="fa fa-calendar"></i> {{ post.date | date: "%B %d, %Y" }}</div>
          {% if post.excerpt %}
            <small class="archive__item-excerpt">{{ post.excerpt | strip_html | truncate: 160 }}</small>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  </section>
{% endfor %}

<style>
  .tag-value { cursor: pointer; transition: all 0.2s; border-bottom: 1px dotted #ccc; }
  .tag-value:hover { color: #2185d0; }
  .tag-value.selected { 
    background-color: #2185d0 !important; 
    color: white !important; 
    padding: 0 5px; 
    border-radius: 3px;
    border-bottom: none;
  }
  .clear-filter-btn {
    margin-top: 15px;
    width: 100%;
    padding: 8px;
    background: #f0f0f0;
    border: 1px solid #ddd;
    cursor: pointer;
  }
  .clear-filter-btn:hover { background: #e0e0e0; }
</style>

<script>
(function() {
  /**
   * 核心筛选逻辑：支持多选（交集过滤）
   */
  function initNewsFilter() {
    const articles = Array.from(document.querySelectorAll('.archive__item'));
    const sections = Array.from(document.querySelectorAll('.year-section'));
    const tagButtons = document.querySelectorAll('.tag-value');
    const clearBtn = document.getElementById('clear-filter');
    
    // 如果页面没有找到筛选元素，直接退出防止报错
    if (tagButtons.length === 0 || articles.length === 0) return;

    let selectedTags = new Set();

    // 更新页面显示
    function updateDisplay() {
      // 1. 过滤文章
      articles.forEach(article => {
        if (selectedTags.size === 0) {
          article.style.display = ''; // 显示所有
          return;
        }
        // 获取文章自带的标签字符串
        const postTagsRaw = article.getAttribute('data-tags') || "";
        const postTagsArray = postTagsRaw.split('|').map(t => t.trim());
        
        // 只有包含所有选中标签的文章才显示 (AND 逻辑)
        const isMatch = Array.from(selectedTags).every(tag => postTagsArray.includes(tag));
        article.style.display = isMatch ? 'block' : 'none';
      });

      // 2. 处理年份标题和计数
      sections.forEach(section => {
        const visibleInThisYear = Array.from(section.querySelectorAll('.archive__item'))
                                     .filter(a => a.style.display !== 'none');
        const count = visibleInThisYear.length;
        
        // 如果该年份下没有匹配文章，隐藏整个年份区块
        section.style.display = count > 0 ? 'block' : 'none';
        
        // 更新标题后的数字，例如 2024 (6) -> 2024 (2)
        const subtitle = section.querySelector('.archive__subtitle');
        if (subtitle) {
          const year = section.getAttribute('data-year');
          subtitle.textContent = `${year} (${count})`;
        }
      });
    }

    // 绑定标签点击事件
    tagButtons.forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const tag = this.getAttribute('data-full-tag').trim();
        
        if (selectedTags.has(tag)) {
          selectedTags.delete(tag);
          this.classList.remove('selected');
        } else {
          selectedTags.add(tag);
          this.classList.add('selected');
        }
        updateDisplay();
      });
    });

    // 绑定清除按钮
    if (clearBtn) {
      clearBtn.addEventListener('click', function(e) {
        e.preventDefault();
        selectedTags.clear();
        tagButtons.forEach(b => b.classList.remove('selected'));
        updateDisplay();
      });
    }
    
    console.log("News filter system ready.");
  }

  // 关键：AcademicPages 侧边栏是动态的，使用 window.onload 确保 DOM 树完全稳定
  if (document.readyState === 'complete') {
    initNewsFilter();
  } else {
    window.addEventListener('load', initNewsFilter);
  }
})();
</script>


{% comment %}
<!-- 

{% include base_path %}

{% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse %}

{% for year_group in posts_by_year %}
  <section class="year-section">
    <h1 id="{{ year_group.name | slugify }}" class="archive__subtitle">
      {{ year_group.name }} ({{ year_group.items.size }})
    </h1>
    
    <div class="grid__wrapper">
      {% for post in year_group.items %}
        <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
          {% if post.image_path %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">
                <img 
                  style="height:210px;object-fit:cover;" 
                  src=
                  {% if post.image_path contains "://" %}
                    "{{ post.image_path }}"
                  {% else %}
                    "{{ post.image_path | prepend: "/images/" | prepend: base_path }}"
                  {% endif %}
                alt="{% if post.alt %}{{ post.alt }}{% endif %}">
              </a>
            </div>
          {% else %}
            <div class="archive__item-teaser">
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">
                <img 
                  style="height:210px;object-fit:cover;" 
                  src="{{ '/images/Loading.png' | prepend: base_path }}" 
                  alt="Default image">
              </a>
            </div>
          {% endif %}

          {% if post.id %}
            {% assign title = post.covertitle | markdownify | remove: "<p>" | remove: "</p>" %}
          {% else %}
            {% assign title = post.covertitle %}
          {% endif %}

          <div class="archive__item-title">
            {% if post.link %}
              <a href="{{ post.link }}">{{ title }}</a> <a href="{{ base_path }}{{ post.url }}" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
            {% else %}
              <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
            {% endif %}
          </div>

          {% if post.collection == 'teaching' %}
            <div> {{ post.type }}, <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </div>
          {% elsif post.collection == 'publications' %}
            <div>Published in <i>{{ post.venue }}</i>, {{ post.date | default: "1900-01-01" | date: "%Y" }} </div>
          {% elsif post.date %}
            <div class="page__meta"> <i class="fa fa-calendar" aria-hidden="true"></i> <time datetime="{{ post.date | default: "1900-01-01" | date_to_xmlschema }}">{{ post.date | default: "1900-01-01" | date: " %B %d, %Y" }}</time></div>
          {% endif %}

          {% if post.excerpt %}
            <small class="archive__item-excerpt" itemprop="description">{{ post.excerpt | markdownify }}</small>
          {% endif %}
        </article>

      {% endfor %}
    </div>
  </section>
{% endfor %}


{% capture written_year %}'None'{% endcapture %}
{% for post in site.posts %}
  {% capture year %}{{ post.date | date: '%Y' }}{% endcapture %}
  {% if year != written_year %}
    <h2 id="{{ year | slugify }}" class="archive__subtitle">{{ year }}</h2>
    {% capture written_year %}{{ year }}{% endcapture %}
  {% endif %}

  {% include archive-single.html type="grid" %}
{% endfor %} -->
{% endcomment %}
